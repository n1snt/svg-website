<svg width="400" height="250" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Container for dynamically loaded pages -->
    <g id="page1"></g>
    <g id="page2" display="none"></g>
    <g id="page3" display="none"></g>

    <script href="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        <![CDATA[
            let count = 0;
            let currentPage = 1;
            let pagesLoaded = {};

            // Load SVG content from external file
            function loadPage(pageNum) {
                if (pagesLoaded[pageNum]) {
                    return Promise.resolve();
                }

                return fetch('views/page' + pageNum + '.svg')
                    .then(response => response.text())
                    .then(svgText => {
                        const parser = new DOMParser();
                        const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');
                        const svgContent = svgDoc.documentElement;

                        // Get all child elements except script tags
                        const children = Array.from(svgContent.children).filter(child => child.tagName !== 'script');

                        const container = document.getElementById('page' + pageNum);
                        container.innerHTML = '';

                        children.forEach(child => {
                            const importedNode = document.importNode(child, true);
                            container.appendChild(importedNode);
                        });

                        pagesLoaded[pageNum] = true;

                        // Re-attach event listeners after loading
                        attachPageListeners(pageNum);
                    })
                    .catch(error => {
                        console.error('Error loading page ' + pageNum + ':', error);
                    });
            }

            // Attach event listeners for a specific page
            function attachPageListeners(pageNum) {
                if (pageNum === 1) {
                    // Counter buttons
                    $('#addBtn').off('click').on('click', function() {
                        count++;
                        updateCounter();
                    });

                    $('#subtractBtn').off('click').on('click', function() {
                        count--;
                        updateCounter();
                    });

                    // Navigation
                    $('#nextBtn1').off('click').on('click', function() {
                        showPage(2);
                    });
                } else if (pageNum === 2) {
                    $('#backBtn2').off('click').on('click', function() {
                        showPage(1);
                    });

                    $('#nextBtn2').off('click').on('click', function() {
                        showPage(3);
                    });
                } else if (pageNum === 3) {
                    $('#backBtn3').off('click').on('click', function() {
                        showPage(2);
                    });

                    $('#homeBtn').off('click').on('click', function() {
                        showPage(1);
                    });
                }
            }

            // Load count from localStorage
            function loadCount() {
                const savedCount = localStorage.getItem('counter');
                if (savedCount !== null) {
                    count = parseInt(savedCount, 10);
                    $('#counter').text(count);
                }
            }

            // Save count to localStorage
            function saveCount() {
                localStorage.setItem('counter', count.toString());
            }

            // Update counter display
            function updateCounter() {
                $('#counter').text(count);
                saveCount();
            }

            function showPage(pageNum) {
                // Hide all pages
                document.getElementById('page1').setAttribute('display', 'none');
                document.getElementById('page2').setAttribute('display', 'none');
                document.getElementById('page3').setAttribute('display', 'none');

                // Load and show the requested page
                loadPage(pageNum).then(() => {
                    document.getElementById('page' + pageNum).removeAttribute('display');
                    currentPage = pageNum;

                    // Update counter display if on page 1
                    if (pageNum === 1) {
                        $('#counter').text(count);
                    }
                });
            }

            $(document).ready(function() {
                // Load saved count on page load
                loadCount();

                // Load and show page 1 initially
                showPage(1);
            });
        ]]>
    </script>
</svg>
